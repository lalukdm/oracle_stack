{% extends "base.html" %}

{% block title %}Семинар 1 – Задание 1{% endblock %}

{% block content %}
  <h1>Семинар 1 – Задание 1</h1>
  <p>Демонстрация обработки значений, передаваемых через SELECT и набор чекбоксов.</p>

  <div class="layout-two-col">
    <!-- Левая колонка: форма -->
    <form method="post" class="form-card half" id="task1-form">
      <div class="form-group">
        <label for="faculty">Выберите факультет</label>
        <select id="faculty" name="faculty">
          {% for code, name in faculty_names.items() %}
            <option value="{{ code }}">{{ name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label>Выберите ваши интересы</label>
        <small class="hint">Отмечайте нужные варианты галочками.</small>

        <div class="checkbox-list">
          {% for code, name in interest_names.items() %}
            <label class="checkbox-item">
              <input
                type="checkbox"
                class="interest-checkbox"
                name="interests"
                value="{{ code }}"
              >
              <span>{{ name }}</span>
            </label>
          {% endfor %}
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn">Отправить форму</button>
        <a href="{{ url_for('seminar1_index') }}" class="btn btn-secondary">Назад к семинару</a>
      </div>
    </form>

    <!-- Правая колонка: онлайн-просмотр -->
    <div class="preview-card half">
      <h2>Текущий выбор</h2>

      <p><strong>Факультет:</strong> <span id="preview-faculty">не выбрано</span></p>

      <p><strong>Интересы:</strong></p>
      <ul id="preview-interests">
        <li>ничего не выбрано</li>
      </ul>

      <p class="hint">Эта область обновляется автоматически при изменении выбора.</p>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const facultySelect = document.getElementById('faculty');
      const previewFaculty = document.getElementById('preview-faculty');
      const previewInterests = document.getElementById('preview-interests');
      const interestCheckboxes = document.querySelectorAll('.interest-checkbox');

      const facultyMap = {{ faculty_names | tojson }};
      const interestMap = {{ interest_names | tojson }};

      function updateFacultyPreview() {
        const value = facultySelect.value;
        previewFaculty.textContent = facultyMap[value] || 'не выбрано';
      }

      function updateInterestsPreview() {
        const checked = Array.from(interestCheckboxes)
          .filter(cb => cb.checked)
          .map(cb => interestMap[cb.value] || cb.value);

        previewInterests.innerHTML = '';

        if (checked.length === 0) {
          const li = document.createElement('li');
          li.textContent = 'ничего не выбрано';
          previewInterests.appendChild(li);
          return;
        }

        checked.forEach(text => {
          const li = document.createElement('li');
          li.textContent = text;
          previewInterests.appendChild(li);
        });
      }

      // Слушатели
      facultySelect.addEventListener('change', updateFacultyPreview);
      interestCheckboxes.forEach(cb => {
        cb.addEventListener('change', updateInterestsPreview);
      });

      // Инициализация при загрузке
      updateFacultyPreview();
      updateInterestsPreview();
    });
  </script>
{% endblock %}
